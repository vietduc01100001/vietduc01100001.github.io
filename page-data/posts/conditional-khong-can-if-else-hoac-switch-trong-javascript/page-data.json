{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/conditional-khong-can-if-else-hoac-switch-trong-javascript/","result":{"data":{"markdownRemark":{"id":"b0aa4516-5d01-541e-a223-a40e240523de","html":"<p>Một bài note nhanh và ngắn chia sẻ về sự hay ho của JavaScript. Mới đây mình gặp một tình huống nho nhỏ như sau.</p>\n<p>Có một entity <code class=\"language-text\">User</code> với 2 trường: <code class=\"language-text\">status</code> và <code class=\"language-text\">type</code>. Mỗi trường lần lượt có những giá trị sau:</p>\n<ul>\n<li><code class=\"language-text\">status</code>: <code class=\"language-text\">[&#39;NO_ACCESS&#39;, &#39;PENDING_SUBSCRIBE&#39;, &#39;SUBSCRIBED&#39;, &#39;PENDING_CANCEL&#39;]</code></li>\n<li><code class=\"language-text\">type</code>: <code class=\"language-text\">[&#39;NO_ACCESS&#39;, &#39;DELAYED&#39;, &#39;CLICK2REFRESH&#39;, &#39;REALTIME&#39;]</code></li>\n</ul>\n<p>Nhiệm vụ của mình là viết một API để update 2 trường trên:</p>\n<ul>\n<li>\n<p><code class=\"language-text\">PUT /users/:user_id</code></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t<span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PENDING_SUBSCRIBE\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"REALTIME\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>Vì 2 trường này có mối liên hệ với nhau, nên sau khi vận dụng hết năng lực toán học cao cấp từ 12 năm đèn vở bonus vài năm tự đi chợ mua rau của mình, mình tính ra được có tất cả 16 trường hợp cần xử lý ở trong API trên. Không sợ kẻ thù đông, mình sắn ống tay ra trận. Sau đây là tường thuật diễn biến trận đấu.</p>\n<h3 id=\"round-1-if-else\" style=\"position:relative;\"><a href=\"#round-1-if-else\" aria-label=\"round 1 if else permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Round 1: <code class=\"language-text\">if else</code></h3>\n<p>Ban đầu, mình thử code ngay với kiểu <code class=\"language-text\">if else</code> truyền thống.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'NO_ACCESS'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'NO_ACCESS'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'DELAYED'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'CLICK2REFRESH'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'REALTIME'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'PENDING_SUBSCRIBE'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'NO_ACCESS'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'DELAYED'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token operator\">...</span></code></pre></div>\n<p>Và chẳng cần phải nói, đống code trên nhìn như shit vậy. Quá rối rắm và nếu không cẩn thận thì rất dễ để viết sai tên trường hoặc giá trị so sánh. Vì vậy, mình đã chuyển sang dùng vũ khí lợi hại hơn.</p>\n<h3 id=\"round-2-switch-case\" style=\"position:relative;\"><a href=\"#round-2-switch-case\" aria-label=\"round 2 switch case permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Round 2: <code class=\"language-text\">switch case</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'NO_ACCESS'</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> <span class=\"token string\">'NO_ACCESS'</span><span class=\"token operator\">:</span>\n                <span class=\"token comment\">// ...</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token string\">'DELAYED'</span><span class=\"token operator\">:</span>\n                <span class=\"token comment\">// ...</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token string\">'CLICK2REFRESH'</span><span class=\"token operator\">:</span>\n                <span class=\"token comment\">// ...</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token string\">'REALTIME'</span><span class=\"token operator\">:</span>\n                <span class=\"token comment\">// ...</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'PENDING_SUBSCRIBE'</span><span class=\"token operator\">:</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'SUBSCRIBED'</span><span class=\"token operator\">:</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'PENDING_CANCEL'</span><span class=\"token operator\">:</span>\n        <span class=\"token comment\">// ...</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tuy code đã nhìn gọn hơn, nhưng cơ bản nó vẫn không khác <code class=\"language-text\">if else</code> là mấy. Càng nhiều <code class=\"language-text\">status</code> và <code class=\"language-text\">type</code> thì đoạn code sẽ càng dài và khó đọc. Đến lúc này, mình đành phải vận nội công, tận dụng tối đa tính dynamic của JavaScript, và kết quả là…</p>\n<h3 id=\"round-3-object-mapping\" style=\"position:relative;\"><a href=\"#round-3-object-mapping\" aria-label=\"round 3 object mapping permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Round 3: Object mapping</h3>\n<p>Sử dụng giá trị của 2 trường <code class=\"language-text\">status</code> và <code class=\"language-text\">type</code>, mình tạo ra một object như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> handlerMapping <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">NO_ACCESS</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function-variable function\">NO_ACCESS</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">DELAYED</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">CLICK2REFRESH</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">REALTIME</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ...</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">PENDING_SUBSCRIBE</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Lúc này, việc gọi hàm xử lý trở nên dễ dàng hơn rất nhiều:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// get the handler function</span>\n<span class=\"token keyword\">const</span> handler <span class=\"token operator\">=</span> handlerMapping<span class=\"token punctuation\">[</span>user<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>user<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\">// execute the function</span>\n<span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Cách sử dụng object mapping làm giảm bớt những keyword lặp đi lặp lại của 2 cách trên, phù hợp với những trường hợp điều kiện check dài với mỗi trường có nhiều giá trị. Dù không phải là cái gì đó quá đột phá nhưng mình cảm thấy khá hay ho và đáng để chia sẻ. Cảm ơn các bạn đã đọc hết bài này. 🤗</p>","fields":{"slug":"/posts/conditional-khong-can-if-else-hoac-switch-trong-javascript/","categorySlug":"/category/knowledge/","tagSlugs":["/tag/javascript/"]},"frontmatter":{"date":"2020-09-01T04:30:00.000Z","description":"Một bài note nhanh và ngắn chia sẻ về sự hay ho của JavaScript. Mới đây mình gặp một tình huống nho nhỏ như sau.","tags":["javascript"],"title":"Conditional không cần if else hoặc switch trong JavaScript","category":"Knowledge","socialImage":{"publicURL":"/static/7f91e8bc19b01370bc0364facd0e7bb3/thumb.png"}}}},"pageContext":{"slug":"/posts/conditional-khong-can-if-else-hoac-switch-trong-javascript/"}},"staticQueryHashes":["251939775","2803610385","401334301"]}